<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Shop - Home</title>
    <link rel="stylesheet" href="static/css/style.css">
</head>

<body>
    <header>
        <div>
            <h2>Shop</h2>
        </div>
        <div>
            <a href="/cart-page">Cart</a>
            <a href="/orders-page">Orders</a>
            <a href="/login-page" id="login-link">Login/Register</a>
            <a href="#" id="logout-link" style="display:none;">Logout</a>
            <a href="/admin-page" id="admin-link">Admin</a>
        </div>
    </header>

    <div class="product-list" id="product-list">
        <!-- Products will be injected here -->
    </div>
    <script src="static/js/config.js"></script>
    <script src="static/js/auth.js"></script>
    <script>
        async function loadProducts() {
            const res = await fetch(`${API_URL}/products/`);
            const products = await res.json();
            const container = document.getElementById("product-list");
            container.innerHTML = '';
            products.forEach(product => {
                container.innerHTML += `
            <div class="product">
                <img src="${product.image_url || 'https://via.placeholder.com/150'}" alt="${product.name}">
                <h3>${product.name}</h3>
                <p>$${product.price.toFixed(2)}</p>
                <p>Stock: ${product.stock}</p>
                <input type="number" min="1" value="1" id="qty-${product.id}" style="width:50px;">
                <button onclick="addToCart(${product.id})">Add to Cart</button>
            </div>
        `;
            });
        }

        async function addToCart(productId) {
            const qty = parseInt(document.getElementById(`qty-${productId}`).value);
            const token = localStorage.getItem('token');
            if (!token) { alert("Please login first"); return; }
            const res = await fetch(`${API_URL}/cart/add`, {
                method: "POST",
                headers: { "Content-Type": "application/json", "Authorization": `Bearer ${token}` },
                body: JSON.stringify({ id: productId, quantity: qty })
            });
            const data = await res.json();
            if (res.ok) alert("Added to cart");
            else alert(data.detail || "Error adding to cart");
        }

        loadProducts();
    </script>
</body>

</html>